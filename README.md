# AI FACTORY — фабрика агентів і знань

## Визначення
**AI FACTORY** — це архітектура, де головний агент (**Dispatcher**) створює та координує спеціалізованих під-агентів із власними PACK-бібліотеками знань. Разом вони працюють як виробничий конвеєр, серійно випускаючи прикладні системи. Перший виріб — **автоматизована трейдинг-система**.

---

## Стратегічна карта
- **Діагноз**: залежність від однієї моделі, ручна координація, змішання ролей.  
- **Принципи**: розділення обов’язків, прості інтерфейси, швидкі ітерації, дисципліна версій.  
- **Дії**: багаторольова архітектура GPT + стандартизовані PACK-бібліотеки + автоперевірки.

---

## Архітектура
- **Dispatcher (Router)**: приймає задачі, маршрутизує до ролей.  
- **Ролі-агенти**:  
  - Архітектор — розкладає вимогу на модулі, API та контракти.  
  - Програміст — пише код за контрактами.  
  - Рев’юер — аналізує, складає тести, робить code review.  
  - Стратег/Квант — логіка сигналів, фактори.  
  - Дані/ETL — пайплайни, валідація якості даних.  
  - Бектестер — експерименти, метрики, артефакти.  
  - Ризик-офіцер — перевірки стабільності, оверфіту, лімітів.  
- **Шина артефактів**: єдиний протокол обміну (issue → PR → тести → звіти).

---

## PACK-бібліотеки
- `/libs/core`: утиліти (таймінг, логування, I/O).  
- `/libs/data`: джерела даних, перевірки якості, кеш.  
- `/libs/signals`: фактори, правила побудови.  
- `/libs/models`: ML/стратегії (fit/predict).  
- `/libs/risk`: позиціювання, стопи, ліміти, VaR-перевірки.  
- `/libs/backtest`: движок, метрики, візуалізації, walk-forward.  
- `/libs/exchange`: адаптери до бірж/брокерів.  

Кожен модуль має: `README-контракт`, приклади, тести, чек-лист вхід/вихід.

---

## Prompt Patterns
Інваріант: **Роль → Контекст → Обмеження → Формат → Self-check**.  
- Архітектор: вхід = вимога, вихід = список модулів, API-контракти, ризики.  
- Програміст: контракт → код + тести; self-check = лінтер, складність, крайові кейси.  
- Бектестер: діапазон, cutoffs, walk-forward → таблиця метрик + графіки; self-check = стратифікація, витік даних.

---

## Розмноження моделей
- Окремі “персони” з інструкціями + доступом до PACK-ів.  
- Версіонування промптів (vX.Y).  
- Каталог патернів (класифікація, генерація, рев’ю).  
- Контроль якості: A/B моделей, вибір кращої за метриками.

---

## Контроль ітерацій
- Ритм: добові спринти (ранок — план, вечір — звіт).  
- Авто-ворота: PR проходить тільки якщо тести зелені, бектест ≥ бенчмарка, ризик-чек без прапорів.  
- Логи: для кожної зміни — конфіг, seed, метрики, артефакти.

---

## Eval-набір (MVP трейдинг)
- Дані: мінімум 3 ринки × 3 режими (тренд, флет, волатильність).  
- Метрики: CAGR, Sharpe, maxDD, Calmar, turnover, slippage-stress.  
- Перевірки: walk-forward, k-fold по часу, out-of-sample, live-shadow.  
- Анти-оверфіт: штраф за складність, randomization tests, reality check.

---

## Контракти (інтерфейси)
- Стратегія: `ingest(data) → fit(cfg) → predict(data) → positions`.  
- Ризик: `assess(positions, pnl, stress_cfg) → limits`.  
- Бектест: `run(strategy, data, costs_cfg) → report(таблиці, графіки, артефакти)`.

---

## Операційний процес
- Будь-яка задача = тикет: Роль → Мета → Вхід → Обмеження → Формат → Done.  
- Dispatcher розкидає задачі по агентах.  
- Рев’юер блокує до виконання Done-критеріїв.

---

## Міграція (шлях уперед)
1. Зафіксувати контракти бібліотек.  
2. Створити ролі-промпти (архітектор, програміст, рев’юер, бектестер, ризик).  
3. Поставити ворота CI (тести, мінімальний backtest, чек-листи).  
4. Далі — розширювати ринки/стратегії за єдиним ритуалом.

---

## Ризики
- Зоопарк агентів без контрактів → хаос.  
- Оверфіт метрик → гарні графіки, погана реальність.  
- Вузьке горло даних → злам ритму.  
- Відсутність “воріт” → деградація якості.  
- Залежність від одного промпта → не масштабується.

---

## Status (Roadmap)
- **v0 — файловий прототип**: Dispatcher + агенти, запуск вручну через `queue_in` / `queue_out`.  
- **v1 — черга/воркери**: додавання Redis/RabbitMQ для асинхронної роботи, SLA та retry-політика.  
- **v2 — веб-дашборд**: інтерактивний інтерфейс, моніторинг завдань, управління PACK-бібліотеками.  
- **v3 — продакшн-модульність**: масштабування фабрики на інші проєкти (бізнес-асистенти, дослідники, агенти для фінансів).

---
